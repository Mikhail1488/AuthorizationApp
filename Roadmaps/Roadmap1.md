# Декомпозиция первого набора требований

### 1. Начальная подготовка проекта к работе

1.1 Прочитать требования

1.2 Создать репозиторий на git

1.3 Создать “Хелловорлд”

### 2. Описываем тестовые данные

#### 2.1 Описываем пользователей

| login | password |
|-------|----------|
| vasya | 123 | 
| admin | admin  |
| q  | ?!# | 
| abcdefghij | qwerty

#### 2.2 Описываем ресурсы

| resourсe | role | user |
|---------|------|------|
|A | READ | vasya |
| A.B.C | WRITE | vasya | 
| A | EXECUTE | admin |
| A | READ | admin |
| A | WRITE | admin |  
| A | READ | admin | 
| A | EXECUTE | q |
| A | EXECUTE | vasya |

### 3. Записываем тесты в bat/sh файл

#### Вывод справки

1.1 Команда: `app.jar`  
Ожидаемый результат: `exitCode 1` + вывод справки

1.2 Команда: `app.jar -h`  
Ожидаемый результат: `exitCode 1` + вывод справки

1.3 Команда: `app.jar -q`  
Ожидаемый результат: `exitCode 0` + вывод справки(особенности реализации)

#### Аутентификация

2.1 `app.jar -log: vasya -pass:123`  
Ожидаемый результат:  `exitCode 0` успех

2.2 `app.jar -pass:123 -log: vasya`  
Ожидаемый результат: `exitCode 0` успех

2.3 `app.jar -log: VASYA -pass:123`  
Ожидаемый результат: `exitCode 2` неверный формат логина

2.4 `app.jar -log: asd -pass:123`  
Ожидаемый результат: `exitCode 3` неизвестный логин

2.5 `app.jar -log: admin -pass:1234`  
Ожидаемый результат: `exitCode 4` неверный пароль

2.6 `app.jar -log: admin -pass:admin `  
Ожидаемый результат:  `exitCode 0` успех

### Авторизация

3.1 `app.jar -log: vasya -pass:123 -role READ -res A`  
Ожидаемый результат:  `exitCode 0` успех

3.2 `app.jar -log: vasya -pass:123 -role DELETE -res A`  
Ожидаемый результат:  `exitCode 5` неизвестная роль

3.3 `app.jar -log: vasya -pass:123 -role WRITE -res A`  
Ожидаемый результат:  `exitCode 6` нет доступа

3.4 `app.jar -log: vasya -pass:123 -role READ -res A.B`  
Ожидаемый результат:  `exitCode 0` успех

3.5 `app.jar -log: admin -pass:admin -role WRITE -res A.B.C`  
Ожидаемый результат:  `exitCode 0` успех

3.6 `app.jar -log: vasya -pass:1234 -role DELETE -res A `  
Ожидаемый результат:  `exitCode 4` неверный пароль

3.7 `app.jar -log: vasya -pass:123 -role WRITE -res a.b.c `  
Ожидаемый результат:  `exitCode 6` нет доступа

3.8 `app.jar -log: admin -pass:admin -role READ -res`   
Ожидаемый результат:  `exitCode 0` условная аутентиф

3.9 `app.jar -log: admin -pass:admin -role EXECUTE -res A`  
Ожидаемый результат: `exitCode 6` выше по дереву

3.10 `app.jar -log: admin -pass:admin -role WRITE -res A.A`  
Ожидаемый результат:  `exitCode 6` брат

### Аккаунтинг

4.1 `app.jar -log: vasya -pass:123 -role READ -res A -ds 2017.01.07 -de 2017.02.12 -vol 100`  
Ожидаемый результат:  `exitCode 0` успех

4.2 `app.jar -log: vasya -pass:1234 -role READ -res A -ds 2017.01.07 -de 2017.02.12 -vol 100 `  
Ожидаемый результат:  `exitCode 4` неверный пароль

4.3 a`pp.jar -log: admin -pass:admin -role WRITE -res A -ds 2017.01.07 -de 2017.02.12 -vol qewqeqw`  
Ожидаемый результат:  `exitCode 7` некорректная активность(объем)

4.4 `app.jar -log: admin -pass:admin -role EXECUTE -res A -ds 2017.01.07 -de 2017.01.02 -vol 234 `  
Ожидаемый результат:  `exitCode 7` некорректная активность(дата)

4.5 `app.jar -log: admin -pass:admin -role READ -res A -ds 432134 -de 2017.02.12 -vol 100`  
Ожидаемый результат:  `exitCode 7` некорректная активность(невалидная дата)

4.6 `app.jar -log: vasya -pass:123 -role READ -res A`  
Ожидаемый результат:  `exitCode 0` условная авторизация

4.7 `app.jar -log: q -pass:123 -role WRITE -res A -ds 2017.01.07 -de 2017.02.12 -vol 100`  
Ожидаемый результат:  `exitCode 4` неверный пароль

4.8 `app.jar -log: qwqe -pass:123 -role WRITE -res A -ds 2017.01.07 -de 2017.01.07 -vol 100`  
Ожидаемый результат:  `exitCode 3` неизвестный логин

4.9 `app.jar -log: USER -pass:123 -role WRITE -res A -ds 2017.01.07 -de 2017.02.12 -vol 100`  
Ожидаемый результат: `exitCode 2` неверный формат логина

4.10 `app.jar -log: admin -pass:admin -role DELETE -res A -ds 2017.01.07 -de 2017.02.12 -vol wqeq`  
Ожидаемый результат:  `exitCode 5` неизвестная роль

4.11 `app.jar -log: vasya -pass:123 -role WRITE -res A -ds 2017.01.07 -de 2017.02.12 -vol 100`  
Ожидаемый результат:  `exitCode 6` нет доступа

4.12 a`pp.jar -log: admin -pass:admin -role EXECUTE -res A -ds 2017.01.02 -de 12162 -vol 234`
Ожидаемый результат:  `exitCode 7` некорректная активность(дата) - проверка второго значения

4.13 `app.jar -log: admin -pass:admin -role EXECUTE -res A -ds 2017.01.02 -vol 234`  
Ожидаемый результат:  `exitCode 7` некорректная активность(дата) - отсутствие второго значения

4.14 `app.jar -log: admin -pass:admin -role EXECUTE -res A -ds 2017.01.02 -vol`  
Ожидаемый результат:  `exitCode 7` некорректная активность(объем) - отсутствие значения объема

### 4. Сценарии простые

4.1 Проверяем наличие аргументов

4.2 Создаем функцию вывода справки(`System.exit(1)`)

4.3 Проверяем надо ли выводить справку `args[0] = “-h”`

4.4 Во всех остальных случаях выводим справку и возвращаем `0`

### 5. Сценарии аутентификации

5.1 Создаем enum с exit-кодами:
| exit code | comment |
|-----------|---------|
| `0` | успех | 
| `1` | справка |
| `2` | неверный формат логина |
| `3` | неизвестный логин |
| `4` | неверный пароль |

5.2 Создаем метод надо ли аутентифицировать (`args[0] == “-login” && args[2] == “-pass”`)

5.3 Создаем метод `validateLogin(login)`, который проверяет правильность формата логина, используя регулярку

5.4 Создаем метод логин существует (делаем тесты что `login == vasya`)

5.5 Создаем метод проверки пароля (делаем тесты что `login == vasya pass == 123`)

### Создание доменной модели  
5.6 Создаем класс(`data class`) `User`( поля `login`, `pass`)

5.7 Создаем коллекцию для хранения юзеров и добавляем туда тестовые данные

5.8 Исправляем методы на работу с коллекцией юзеров

5.9 Создаем класс(`data class`) `ArgHandler` (поля `h`, `login`, `pass`) конструктор которого на вход получит массив параметров командной строки и распарсит их

5.10 В классе `ArgHandler` создаем три метода:
выводСправки(); есть ли аргументы(); нужна аутентификация();

5.11 Проводим рефакторинг, чтобы использовать `ArgHandler`

### 6. Сценарии авторизации

6.1 Создаем класс `Resources`(поля `id`, `path`)

6.2 Создаем `enum` для хранения ролей
| role |
|------|
|`WRITE` |
| `READ` |
| `EXECUTE` |

6.3 Создаем `List` для хранения ресурсов

6.4 Добавляем в `enum` c exit-кодами следующие коды:
| exit code | comment |
|-----------|---------|
| 5 | неизвестная роль |
| 6 | нет доступа |

6.5 Добавляем в класс `ArgHandler` поля `role`, `res` (роль ресурс)

6.6 Создаем метод в классе `ArgHandler` надо ли авторизовать (проверяем “распарсенные” данные, которые получены из массива параметров командной строки конструктора `ArgHandler`(`login`, `pass`, `role`, `res`))

6.7 Создаем метод проверки существования роли(если роль не существует, выводить справку и exit-код `5`)

6.8 Создаем метод проверки доступа юзера к определенному ресурсу(если доступа нет то выводим справку и exit-код - `6`)

6.9 Создаем метод который будет разрешать доступ к потомкам ресурса, с такой же ролью как и у их родителя(проводим тесты на доступ к потомку ресурса с такой же ролью как у родителя)

### 7. Сценарии аккаунтинга

7.1 Добавляем поля `ds` (дата начала сеанса), `de` (дата окончания сеанса), `vol`(объем) в класс `ArgHangler`

7.2 Добавляем опции аргументов командной строки(`ds` задание даты начала сеанса, `de` задание даты окончания сеанса, `vol` задание объема)

7.3 Добавляем проверку на комбинацию аргументов (логин, пароль, роль, путь, дата начала сеанса, дата окончания сеанса, объем)

7.4 Создаем метод проверки валидности даты( дата должна быть формата `YYYY-MM-DD`, иначе невалидна) - выводим exit-код `7`

7.5 Создаем методы проверки валидности объема( объем vol должен быть числом, иначе не валиден) - выводим exit-код `7`

7.6 Добавляем в enum c `exit`-кодами следующие коды:
| exit code | comment |
|-----------|---------|
|7 | некорректная активность |

7.7 Создаем метод надо ли аккаунтить( проверяем все ли данные переданы и правильно распаршены(`login`, `pass`, `role`, `res`, `ds`, `de`, `vol`)

### 8. Хеширование пароля

8.1 Добавить константу для хранения локального параметра хеширования

8.2 Добавить метод для декодирования пароля

8.3 Изменить дата класс `User` - добавить поля `hash` и `salt`

8.4 Обновить тестовые данные для `User`

8.5 Изменить метод, отвечающий за валидацию пароля

### 9. Добавляем и подключаем библиотеку kotlinx.cli

9.1 Изменяем класс `ArgHandler` который обрабатывает входную строку под использование kotlinx.cli

9.2 Проводим рефакторинг функции справки в соответствии с возможностями данной библиотеки
